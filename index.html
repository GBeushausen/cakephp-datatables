<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Cakephp-datatables : CakePHP3 Plugin for DataTables plug-in for jQuery">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cakephp-datatables</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/fheider/cakephp-datatables">View on GitHub</a>

          <h1 id="project_title">Cakephp-datatables</h1>
          <h2 id="project_tagline">CakePHP3 Plugin for DataTables plug-in for jQuery</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/fheider/cakephp-datatables/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/fheider/cakephp-datatables/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="cakephp-datatables" class="anchor" href="#cakephp-datatables" aria-hidden="true"><span class="octicon octicon-link"></span></a>cakephp-datatables</h1>

<p>This plugin implements the jQuery dataTables plugin (<a href="http://www.datatables.net">www.datatables.net</a>) in your CakePHP 3 application.
In addition there was added a multiple column search with request delay to minimize the ajax requests.</p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>CakePHP 3 (<a href="http://www.cakephp.org">http://www.cakephp.org</a>)</li>
<li>jQuery (<a href="http://www.jquery.com">http://www.jquery.com</a>)</li>
<li>jQuery DataTables (<a href="http://www.datatables.net">http://www.datatables.net</a>)</li>
<li>Composer (<a href="http://getcomposer.org">http://getcomposer.org</a>)</li>
</ul>

<h2>
<a id="optional" class="anchor" href="#optional" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional</h2>

<ul>
<li>Twitter Bootstrap 3 (<a href="http://getbootstrap.com">http://getbootstrap.com</a>)</li>
<li>FontAwesome 4 (<a href="http://fortawesome.github.io/Font-Awesome">http://fortawesome.github.io/Font-Awesome</a>)</li>
</ul>

<p>The core templates are written in Twitter Bootstrap syntax and included FontAwesome icons but can be changed easily.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<h3>
<a id="step-1-installation" class="anchor" href="#step-1-installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1: Installation</h3>

<p>Use composer to install this plugin.
Add the following repository and requirement to your composer.json:</p>

<pre><code>"repositories": [
    {
        "type": "git",
        "url": "https://github.com/fheider/cakephp-datatables"
    }
],    
"require": {
    "fheider/cakephp-datatables": "dev-master"
}
</code></pre>

<h3>
<a id="step-2-include-cakephp-plugin-and-load-component-and-helper" class="anchor" href="#step-2-include-cakephp-plugin-and-load-component-and-helper" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Include CakePHP Plugin and load Component and Helper</h3>

<p>Load plugin in <strong><em>app/bootstrap.php</em></strong>:</p>

<pre><code>Plugin::load('DataTables', ['bootstrap' =&gt; false, 'routes' =&gt; false]);
</code></pre>

<p>Include component and helper: </p>

<pre><code>class AppController extends Controller
{

    public $helpers = [
        'DataTables' =&gt; [
            'className' =&gt; 'DataTables.DataTables'
        ]
    ];

    public function initialize()
    {
        $this-&gt;loadComponent('DataTables.DataTables');
    }

}
</code></pre>

<h3>
<a id="step-3-include-assets" class="anchor" href="#step-3-include-assets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: Include assets</h3>

<p>Include jQuery and jQuery DataTables scripts first and then the dataTables logic:</p>

<pre><code>echo $this-&gt;Html-&gt;script('*PATH*/jquery.min.js');
echo $this-&gt;Html-&gt;script('*PATH*/jquery.dataTables.min.js');
echo $this-&gt;Html-&gt;script('*PATH*/dataTables.bootstrap.min.js'); (Optional)
echo $this-&gt;Html-&gt;script('DataTables.cakephp.dataTables.js');
</code></pre>

<p>Include dataTables css:</p>

<pre><code>echo $this-&gt;Html-&gt;css('PATH/dataTables.bootstrap.css');
</code></pre>

<h3>
<a id="step-4-add-business-logic-in-your-controller" class="anchor" href="#step-4-add-business-logic-in-your-controller" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4: Add business logic in your controller</h3>

<p>Use it simply like find:</p>

<pre><code>$data = $this-&gt;DataTables-&gt;find('*TABLE*', [
    'contain' =&gt; []
]);

$this-&gt;set([
    'data' =&gt; $data,
    '_serialize' =&gt; array_merge($this-&gt;viewVars['_serialize'], ['data'])
]);
</code></pre>

<p>The array_merge is required because the component add multiple vars to view like recordsTotal, recordsFiltered, ...
So your serialized data were added to this vars.</p>

<h3>
<a id="step-5-template--view" class="anchor" href="#step-5-template--view" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5: Template / View</h3>

<p>First display your table normal, so no additional request were sended by dataTables.
The table foot is used for the multiple search fields. This could be input- or select-elements.</p>

<pre><code>&lt;table class="table table-striped table-bordered table-hover dataTable"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            ...
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tfoot&gt;
    &lt;tr class="table-search info"&gt;
        &lt;td&gt;&lt;input type="text" placeholder="Search ..." class="form-control input-sm input-block-level" /&gt;&lt;/td&gt;
        &lt;td&gt;&lt;select&gt;&lt;option value=""&gt;---&lt;/option&gt;...&lt;/select&gt;&lt;/td&gt;
        ...
    &lt;/tr&gt;
    &lt;/tfoot&gt;
    &lt;tbody&gt;
    &lt;?php foreach($data as $item): ?&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;?= $item-&gt;id ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?= $item-&gt;name ?&gt;&lt;/td&gt;
        ...
    &lt;/tr&gt;
    &lt;?php endforeach; ?&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
</code></pre>

<p>Then add the dataTables logic.
The options are exaxt the options you get in the dataTables reference (<a href="https://datatables.net/reference/option/">https://datatables.net/reference/option/</a>).</p>

<pre><code>$this-&gt;DataTables-&gt;init([
    'ajax' =&gt; [
        'url' =&gt; $this-&gt;Html-&gt;url(['action' =&gt; 'index']),
    ],
    'deferLoading' =&gt; $recordsTotal,
    'delay' =&gt; 600,
    'columns' =&gt; [
        [
            'name' =&gt; '*MODEL*.id',
            'data' =&gt; 'id'
            'orderable' =&gt; false
        ],
        [
            'name' =&gt; '*MODEL*.name',
            'data' =&gt; 'name'
        ],
        ...
    ]
])-&gt;draw('.dataTable');
</code></pre>

<p>In draw method you set the selector of your table. Delay is an additional option for setting the delay for processing
your search input. If delay is 0 on every key press a request will be sent.</p>

<p><strong>Notes to columns settings</strong></p>

<p>Every column contains 2 important informations: </p>

<pre><code>name = name of your table and field like 'Customers.id'
data = name of the field in json response
</code></pre>

<p>The option <strong>name</strong> is needed for sorting and filtering. The option <strong>data</strong> is needed for processing the json response.<br>
You also can easily add related data (e.g. a customer belongs to a customer group)</p>

<pre><code>name = Group.name
data = group.name
</code></pre>

<p><strong>Please keep in mind!</strong><br>
It is important that the amount of your columns array is the same like your columns in your HTML-Table! </p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cakephp-datatables maintained by <a href="https://github.com/fheider">fheider</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
